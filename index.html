<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=640">

    <link rel="stylesheet" href="stylesheets/core.css" media="screen">
    <link rel="stylesheet" href="stylesheets/mobile.css" media="handheld, only screen and (max-device-width:640px)">
    <link rel="stylesheet" href="stylesheets/github-light.css">

    <script type="text/javascript" src="javascripts/modernizr.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script type="text/javascript" src="javascripts/headsmart.min.js"></script>
    <script type="text/javascript">
      $(document).ready(function () {
        $('#main_content').headsmart()
      })
    </script>
    <title>Excellent numbers by briandfoy</title>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
});
</script>
	<script type="text/javascript"
	  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
	</script>
  </head>

  <body>
<style>
p.math-block > math {
	margin-left: 40px;
	}

math.block {
	margin-left: 40px;
	}

math.inline {
	display: inline;
	}

mo.ab_sep {
	lspace: 0.2em;
	rspace: 0.2em;
	}

div#timings {
	width: 50%;
	align: center;
	}

p.note {
	font-style: italic;
	color: #aaa;
	}

p.indent {
	margin.left: 40px;
	}

div.center {
	text-align: center;
	}
</style>

    <a id="forkme_banner" href="https://github.com/briandfoy/excellent_numbers">View on GitHub</a>
    <div class="shell">

      <header>
        <span class="ribbon-outer">
          <span class="ribbon-inner">
            <h1>Excellent numbers</h1>
            <h2>Compute excellent numbers</h2>
          </span>
          <span class="left-tail"></span>
          <span class="right-tail"></span>
        </span>
      </header>

      <section id="downloads">
        <span class="inner">
          <a href="https://github.com/briandfoy/excellent_numbers/zipball/master" class="zip"><em>download</em> .ZIP</a><a href="https://github.com/briandfoy/excellent_numbers/tarball/master" class="tgz"><em>download</em> .TGZ</a>
        </span>
      </section>


      <span class="banner-fix"></span>


      <section id="main_content">

<p class="note"><i>Not the phone number website <a href="http://www.excellentnumbers.com">excellentnumbers.com</a></i></p>

<h2>The project</h2>

<p>I started computing some interesting numbers by brute force in Perl. As the numbers got bigger Perl got slower and slower. I optimized the algorithm and that worked for awhile, but that only went so far. For much bigger numbers, I had to drop into C. Once in C, I had to go wide. I've got a good case study for improving the performance of a program.</p>

<p class="indent">—brian d foy &lt;brian.d.foy@gmail.com&gt;</p>

<h2>The numbers</h2>

<p>The full list is in the <a href="https://github.com/briandfoy/excellent_numbers/blob/master/excellent.txt">excellent.txt file in the repo</a>, but we also <a href="https://twitter.com/excellent_nums">tweet them</a> as they come in (albeit out of sequence).</p>

<div align="center">
<a class="twitter-timeline" href="https://twitter.com/excellent_nums" data-widget-id="669094319110774784">Tweets by @excellent_nums</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</div>

<h2>The math</h2>

<p>
A number $N$ is excellent if you can break its digits into equal halves $a$ and $b$ such that $b^2 - a^2$ is $N$.
</p>

<p>For example, for $530901$:</p>

$$
\begin{align}
530901 & \rightarrow \overset{a}{530} \quad \overset{b}{901} \\

b^2 - a^2 & = 901^2 - 530^2 \\

          & = 811801 - 280900 \\

          & = 530901
\end{align}
$$

<p>
Represent the number $N$ as $ab$ where that is the concatenation of digits in $a$ and $b$ and not the product of them. Thus, $N$ is $a \cdot 10^k + b$, where $k$ is the number of digits in $a$. Given that, an excellent number is one where $b^2 - a^2 = a \cdot 10^k + b$.
</p>

<h3>An interesting pattern</h3>

<p>This pyramid is a pattern of numbers that are excellent:</p>

<pre>
        4 8
      3 4 6 8
     33 4 66 8
    333 4 666 8
   3333 4 6666 8
  33333 4 66666 8
 333333 4 666666 8
3333333 4 6666666 8
</pre>

<p>
These numbers are of the form of a summation of powers of 10 with a little extra added to the $10^0$ term. Let $k$ be the number of decimal digits in $a$ (or $b):
</p>

$$
\begin{align}
a & = 3 ( \sum\limits_{i=0}^k 10^i ) + 1 \\
b & = 6 ( \sum\limits_{i=0}^k 10^i ) + 2
\end{align}
$$

<p>
But $b$ is really just double $a$, which you see by inspection even without the fancy symbols:
</p>

$$
\begin{align}
a & = & 3 ( \sum\limits_{i=0}^k 10^i ) + 1 \\
b & = 2 ( & 3 ( \sum\limits_{i=0}^k 10^i ) + 1 \: \: ) \\
b & = 2 a
\end{align}
$$

<p>
Call that summation (with a little extra) $N$. The number $ab$ is a multiple of $N$. Shift the digits of $a$ over $k+1$ powers of $10$ to give them the right magnitude:
</p>

$$
\begin{align}
ab & = 10^{k+1} N  + 2 N \\
   & = ( 10^{k+1} + 2 ) N
\end{align}
$$

<p>
The term $10^{k+1} + 2$ doesn't look that interesting at first, but it's also $9$ repeated $k$ times (with a little extra little extra):
</p>

$$
\begin{align}
10^{k+1}     & = 9 ( \sum\limits_{i=0}^k 10^i ) + 1 \\

10^{k+1} + 2 & = 9 ( \sum\limits_{i=0}^k 10^i ) + 1 + 2 \\
             & = 9 ( \sum\limits_{i=0}^k 10^i ) + 3 \\
             & = 3 ( 3 ( \sum\limits_{i=0}^k 10^i ) + 1 ) \\
             & = 3 N
\end{align}
$$

<p>
Putting this back into $ab$:
</p>

$$
\begin{align}
ab & = ( 10^{k+1} + 2 ) N\\
   & = ( 3 N ) N\\
   & = 3 N^2
\end{align}
$$


<p>
The difference in squares also reduces to  $3 N^2$:
</p>


$$
\begin{align}
b^2 - a^2 & = (2N)^2 - N^2 \\
          & = 2^2 N^2 - N^2 \\
          & = ( 2^2 - 1 ) N^2 \\
          & = 3 N^2
\end{align}
$$

<p>Both sides of $b^2 - a^2 = ab$ are $3 N^2$, so all numbers of this form are excellent. This includes the number $48$, which is the case for $i = 0$. This also means that there is at least one excellent number for every range of length $2k$ and that there are an infinite number of excellent numbers.</p>


<h3>Another interesting pattern</h3>

<p>If a number $ab$ is excellent, that number concatenated an odd number of times is also excellent. $3468$ is excellent, so $346834683468$ is excellent.</p>

<h2>The Algorithm</h2>

<p>These numbers are an interesting programming exercise, although most people stop programming before they get to the interesting bits. If you apply brute force and check every number, you can easily do 10- or 12-digit numbers. After that things start to get slow. When their programs get slow, people find something else to do, leaving the good parts for those who stuck at it.</p>

<p>You don't have to check every number. Instead of taking $ab$ and applying some <code>is_excellent()</code> function to it, you can start with $a$ and determine if some $b$ exists that makes $ab$ excellent.</p>

<p>By checking $a$, you eliminate $10^n - 1$ cases. Instead of checking:</p>

$$530 \; 000, 530 \; 001, 530 \; 002, \cdots 530 \; 999$$

<p>you use $530$ to find one value of $b$ that might work.</p>

<p>To do this, you can rearrange the equation. First, represent the single value $b$ as a sum that separates the digits of $a$ from the digits of $b$, where $k$ is the number of digits in $a$:</p>

$$
\begin{align}
b^2 - a^2 & = ab \\
& = a 10^{k+1} + b
\end{align}
$$

Collecting terms and rearranging:

$$
\begin{align}
a^2 - a 10^{k+1} & = b^2 - b \\
& = b ( b - 1 )
\end{align}
$$


<p>
We know the value of $a$ because we chose it, and we know the value of $a^2 + a 10^{k+1}$. We have to find the value of $b$ where $b ( b - 1 )$ is the same value. For large enough $b$, $b ( b - 1 )$ is almost the same as $b^2$. We can easily calculate
</p>

$$b = \sqrt{a^2 + a 10^{k+1}}$$

<p>Furthermore, for $b^2 - a^2$, there's some maximum value of $a$ for which there are no longer a possible value of $b$. The largest $b$ comprises only the digit $9$ repeated $k$ times. If $b$ has four digits, its maximum value is $9999$. There's some value of $a$ past which $9999^2 - a^2 = a 10^k + 9999$ has a solution.</p>

<p>
By guessing through bisection, we can find this maximum value, which is a little less than $6.2 \cdot 10^{k-1}$.
</p>

<p>
But it gets better. We can immediately discount some values of $a$. First, $a$ must be even and not end in $2$. We know this when we look at the values mod 10:
</p>

$$
\begin{align}
( b^2 - a^2 ) \mod 10 & = (a 10^k + b ) \mod 10 \\

b^2 \mod 10 - a^2 \mod 10 & = a 10^k \mod 10 + b \mod 10 \\

b^2 \mod 10 - a^2 \mod 10 & = b \mod 10 \\

b^2 \mod 10 - b \mod 10 & = a^2 \mod 10
\end{align}
$$

<p>
A square ends in the digits $\{ 0, 1, 4, 5, 6, 9 \}$, so $b^2 \mod 10 - b \mod 10$ must also end with one of those digits because
it's the same number. If we take some $b$ and compute
$(b^2 - b) mod 10$, only values of $b$ ending in $\{ 0, 1, 3, 5, 6, 8 \}$ produce a value that are in  $\{ 0, 1, 4, 5, 6, 9 \}$. (those values being $\{ 0, 6 \}$):
</p>

<pre>
	0*0 - 0 = 0  works
	1*1 - 1 = 0  works
	2*2 - 2 = 2  doesn't work
	3*3 - 3 = 6  works
	4*4 - 4 = 2  doesn't work
	5*5 - 5 = 0  works
	6*6 - 6 = 0  works
	7*7 - 7 = 2  doesn't work
	8*8 - 8 = 6  works
	9*9 - 9 = 2  doesn't work
</pre>

<p>
The only values of $a$ that will produce $\{ 0, 6 \}$ as a square are $\{ 0, 4, 6 \}$. This means that we can skip all <math class="inline"><mi>a</mi></math> that are $\{ 1, 2, 3, 5, 7, 8, 9 \}$.
</p>

<p>
From there, it's brute force to check all $a$ ending in $\{ 0, 4, 6 \}$ from $1 \cdot 10^{k-1}$ to $6.2 \cdot 10^{k-1}$.
</p>

<h2>Brass tacks</h2>

<p>
Now that we have an algorithm that excludes most of the numbers, we have to compute some large numbers, where large is relative to the integer size of computer processors. The GMP library can do that for us. I first tried to do that with the <a href="http://www.metacpan.org/module/Math::GMP">Math::GMP</a> library for Perl but it was too slow since it had to convert Perl data structures to the C data structures. I eventually dropped down to C completely. That's pretty fast. I can exhaust the 26-digit space in a couple of days on a handful of less-than-decent processors.
</p>
<p>
Each jump in digits, say from 24- to 26-digits, is a ten-fold increase in numbers to check. If I wanted to do this on my MacBook Air, here's the progression of times (slowly getting slower as the numbers get bigger):
</p>

<div id="timings" class="center" align="center">
<table>
<tr><th>Digits</th><th>Processor time</th></tr>
<tr><td>2</td><td>5 microseconds</td></tr>
<tr><td>4</td><td>5 microseconds</td></tr>
<tr><td>6</td><td>5 microseconds</td></tr>
<tr><td>8</td><td>5 microseconds</td></tr>
<tr><td>10</td><td>15 microseconds</td></tr>
<tr><td>12</td><td>110 microseconds</td></tr>
<tr><td>14</td><td>1 second</td></tr>
<tr><td>16</td><td>11 seconds</td></tr>
<tr><td>18</td><td>130 seconds</td></tr>
<tr><td>20</td><td>20 minutes</td></tr>
<tr><td>22</td><td>3.5 hours</td></tr>
<tr><td>24</td><td>1.5 days</td></tr>
<tr><td>26</td><td>15 days</td></tr>
<tr><td>28</td><td>150 days</td></tr>
<tr><td>30</td><td>4 years</td></tr>
</table>
</div>

<p>
That's just my laptop. The next tactic is to go wide. Instead of one processor, break up the problem and distribute it among several processors. For instance, for 28-digit numbers, it takes 150 days on one processor, or a month on 5 processors or two weeks on 10 processors. We can spin up Amazon EC2 and let it chew away at the problem.
</p>


<h2>Contributions</h2>

<p>
I first found this problem through Mark Jason Dominus's <a href="http://blog.plover.com/math/excellent.html">Excellent Numbers</a>. He provided some optimizations that I worked out before I read far enough ahead.
</p>

<p>
Joe Zbiciak contributed the modulus congruence optimization.
</p>

<p>
Phil Doroff from <a href="http://www.servercentral.com">ServerCentral</a> donated some time on their big hardware.
</p>

<p>
Sinan Ünür helped with <a href="https://www.mathjax.org">MathJax</a> to bring some $\TeX$ goodness to this page.
</p>

<h2>How to contribute</h2>

<p>
There are a list of things you can do:
</p>

<ul>
<li>Implement the algorithm in another language. So far I have C, Perl, and Julia.</li>
<li>Find more optimizations.</li>
<li>Verify that I haven't missed any numbers, or that the ones I have found are indeed excellent.</li>
<li>Add the number to the <a href="https://oeis.org/A162700">excellent number sequence in the Online Encyclopedia of Integer Sequences</a>.</li>
<li>Lend me a big cluster of 1,000 processors.</li>
</ul>

<h2>Further reading</h2>

<p>
I started this as a Perl project, so I've written about this on my Perl blogs. Since then, I've left Perl behind because native C is so much faster.
</p>

<p>
Watch out for some of the other stuff you find out there. Most other spots have errors. If you see an excellent number that starts in 6 or has an odd number of digits, you know they messed up somewhere.
</p>

<ul>
<li> <a href="http://www.masteringperl.org/2015/05/computing-excellent-numbers/">Computing excellent numbers</a></li>

<li> <a href="http://www.masteringperl.org/2015/10/doing-less-work-to-compute-excellent-numbers/">Doing less work to compute excellent numbers</a></li>

<li> <a href="http://blog.plover.com/math/excellent.html">Excellent Numbers</a>, from Mark Jason Dominus</li>

<li> <a href="http://www.masteringperl.org/tag/excellent-numbers/">The "excellent numbers" tag at Mastering Perl</a></li>

<li> <a href="http://blog.plover.com/math/484848.html">484848 is excellent</a>, from Mark Jason Dominus</li>

<li> <a href="https://oeis.org/A162700">The Online Encyclopedia of Integer Sequences, A162700</a></li>
</ul>

</body>
</html>
